<!DOCTYPE html>
<html>
<head>
    <title>Jogo de Tiro</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #222;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
            background-color: #000;
            cursor: crosshair;
        }
        #stats {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
        }
        #boss-timer {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
        }
        #shop-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            border: none;
        }
        #shop-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        #shop-container {
            background-color: #2c3e50;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            padding: 20px;
            color: white;
        }
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background-color: #34495e;
            border-radius: 5px;
        }
        .shop-item button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 3px;
            cursor: pointer;
        }
        .shop-item button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        #close-shop {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 20px;
            cursor: pointer;
        }
        #coins-display {
            position: absolute;
            top: 50px;
            left: 10px;
            color: gold;
            font-size: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
        }
        .coin {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: gold;
            border-radius: 50%;
            z-index: 1;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="stats">Pontos: 0 | Vida: 100</div>
    <div id="boss-timer">Boss em: 15s</div>
    <div id="coins-display">Moedas: 0</div>
    <button id="shop-button">Loja</button>
    
    <div id="shop-overlay">
        <div id="shop-container">
            <h2 style="text-align: center;">LOJA DE MELHORIAS</h2>
            <div class="shop-item">
                <div>
                    <h3>Vida Máxima</h3>
                    <p>Aumenta a vida máxima em 20 pontos.</p>
                    <p>Nível: <span id="health-level">1</span> | Vida atual: <span id="current-health">100</span></p>
                </div>
                <button id="buy-health">Comprar (50)</button>
            </div>
            <div class="shop-item">
                <div>
                    <h3>Velocidade de Tiro</h3>
                    <p>Reduz o tempo entre tiros.</p>
                    <p>Nível: <span id="fire-rate-level">1</span> | Cooldown: <span id="current-cooldown">150</span>ms</p>
                </div>
                <button id="buy-fire-rate">Comprar (75)</button>
            </div>
            <div class="shop-item">
                <div>
                    <h3>Tiros Múltiplos</h3>
                    <p>Atira mais de um projétil por vez.</p>
                    <p>Nível: <span id="multi-shot-level">1</span> | Projéteis: <span id="current-bullets">1</span></p>
                </div>
                <button id="buy-multi-shot">Comprar (100)</button>
            </div>
            <div class="shop-item">
                <div>
                    <h3>Velocidade de Movimento</h3>
                    <p>Aumenta a velocidade do jogador.</p>
                    <p>Nível: <span id="move-speed-level">1</span> | Velocidade: <span id="current-speed">5</span></p>
                </div>
                <button id="buy-speed">Comprar (60)</button>
            </div>
            <div class="shop-item">
                <div>
                    <h3>Tamanho do Projétil</h3>
                    <p>Aumenta o tamanho dos seus tiros.</p>
                    <p>Nível: <span id="bullet-size-level">1</span> | Tamanho: <span id="current-bullet-size">5</span></p>
                </div>
                <button id="buy-bullet-size">Comprar (80)</button>
            </div>
            <button id="close-shop">Fechar Loja</button>
        </div>
    </div>

    <script>
        // Configuração do Canvas
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Estatísticas e elementos de interface
        const statsElement = document.getElementById('stats');
        const bossTimerElement = document.getElementById('boss-timer');
        const coinsDisplayElement = document.getElementById('coins-display');
        const shopButton = document.getElementById('shop-button');
        const shopOverlay = document.getElementById('shop-overlay');
        const closeShopButton = document.getElementById('close-shop');
        
        // Sistema de loja e melhorias
        const shopItems = {
            health: {
                level: 1,
                baseValue: 100,
                increment: 20,
                cost: 50,
                costMultiplier: 1.5,
                element: document.getElementById('buy-health'),
                levelElement: document.getElementById('health-level'),
                valueElement: document.getElementById('current-health')
            },
            fireRate: {
                level: 1,
                baseValue: 150,
                improvement: 10, // ms de redução por nível
                cost: 75,
                costMultiplier: 1.5,
                element: document.getElementById('buy-fire-rate'),
                levelElement: document.getElementById('fire-rate-level'),
                valueElement: document.getElementById('current-cooldown')
            },
            multiShot: {
                level: 1,
                baseValue: 1,
                increment: 1,
                cost: 100,
                costMultiplier: 2,
                element: document.getElementById('buy-multi-shot'),
                levelElement: document.getElementById('multi-shot-level'),
                valueElement: document.getElementById('current-bullets')
            },
            moveSpeed: {
                level: 1,
                baseValue: 5,
                increment: 1,
                cost: 60,
                costMultiplier: 1.5,
                element: document.getElementById('buy-speed'),
                levelElement: document.getElementById('move-speed-level'),
                valueElement: document.getElementById('current-speed')
            },
            bulletSize: {
                level: 1,
                baseValue: 5,
                increment: 2,
                cost: 40,
                costMultiplier: 1.5,
                element: document.getElementById('buy-bullet-size'),
                levelElement: document.getElementById('bullet-size-level'),
                valueElement: document.getElementById('current-bullet-size')
            }
        };
        
        // Funções da loja
        function updateShopDisplay() {
            for (const key in shopItems) {
                const item = shopItems[key];
                item.levelElement.textContent = item.level;
                
                if (key === 'fireRate') {
                    const cooldown = Math.max(20, item.baseValue - (item.level - 1) * item.improvement);
                    item.valueElement.textContent = cooldown;
                } else {
                    item.valueElement.textContent = item.baseValue + (item.level - 1) * item.increment;
                }
                
                const currentCost = Math.round(item.cost * Math.pow(item.costMultiplier, item.level - 1));
                item.element.textContent = `Comprar (${currentCost})`;
                
                // Desabilitar botão se não tiver moedas suficientes
                if (coins < currentCost) {
                    item.element.disabled = true;
                } else {
                    item.element.disabled = false;
                }
            }
        }
        
        // Adicionar listeners para os botões da loja
        for (const key in shopItems) {
            const item = shopItems[key];
            item.element.addEventListener('click', () => {
                const currentCost = Math.round(item.cost * Math.pow(item.costMultiplier, item.level - 1));
                
                if (coins >= currentCost) {
                    coins -= currentCost;
                    item.level++;
                    
                    // Aplicar melhoria
                    if (key === 'health') {
                        const newMaxHealth = item.baseValue + (item.level - 1) * item.increment;
                        const healthIncrease = item.increment;
                        playerHealth = Math.min(playerHealth + healthIncrease, newMaxHealth);
                    } else if (key === 'fireRate') {
                        shootingCooldown = Math.max(20, item.baseValue - (item.level - 1) * item.improvement);
                    } else if (key === 'multiShot') {
                        bulletCount = item.baseValue + (item.level - 1) * item.increment;
                    } else if (key === 'moveSpeed') {
                        player.speed = item.baseValue + (item.level - 1) * item.increment;
                    } else if (key === 'bulletSize') {
                        bulletSize = item.baseValue + (item.level - 1) * item.increment;
                    }
                    
                    updateShopDisplay();
                    coinsDisplayElement.textContent = `Moedas: ${coins}`;
                }
            });
        }
        
        // Eventos da loja
        shopButton.addEventListener('click', () => {
            shopOverlay.style.display = 'flex';
            gamePaused = true;
            updateShopDisplay();
        });
        
        closeShopButton.addEventListener('click', () => {
            shopOverlay.style.display = 'none';
            gamePaused = false;
        });
        
        // Variaveis do jogo
        let score = 0;
        let playerHealth = 100;
        let maxPlayerHealth = 100;
        let gameOver = false;
        let gamePaused = false;
        let bossTimer = 15;
        let lastBossTimerUpdate = Date.now();
        let bossActive = false;
        let coins = 0;
        let bulletCount = 1;
        
        // Sistema de moedas
        const coinDrops = [];
        
        // Sistema de cartas para os bosses
        const naipes = ['Paus', 'Copas', 'Diamantes', 'Espadas'];
        const valores = ['10', '9', '8', '7', '6', '5', '4', '3', '2', 'J', 'Q', 'K', 'A'];
        let currentNaipeIndex = 0;
        let currentValorIndex = 0;
        
        // Jogador
        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            size: 30,
            speed: 5,
            color: '#3498db',
            direction: 0,
            moving: {
                up: false,
                down: false,
                left: false,
                right: false
            }
        };
        
        // Controles do mouse
        let mouseX = 0;
        let mouseY = 0;
        let shooting = false;
        
        // Projeteis
        const bullets = [];
        const bulletSpeed = 10;
        let bulletSize = 5;
        const bulletColor = '#f1c40f';
        let lastShot = 0;
        let shootingCooldown = 150; // tempo em ms entre tiros
        
        // Inimigos
        const enemies = [];
        const enemySize = 25;
        const enemySpeed = 2;
        const enemyColor = '#e74c3c';
        let lastEnemySpawn = 0;
        let enemySpawnRate = 1000; // ms entre spawns de inimigos
        
        // Boss
        let boss = null;
        const bossBaseSize = 70;
        const bossBaseSpeed = 1.5;
        const bossBaseHealth = 100;
        
        // Eventos de teclado para movimento
        window.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case 'w': player.moving.up = true; break;
                case 's': player.moving.down = true; break;
                case 'a': player.moving.left = true; break;
                case 'd': player.moving.right = true; break;
            }
        });
        
        window.addEventListener('keyup', (e) => {
            switch(e.key.toLowerCase()) {
                case 'w': player.moving.up = false; break;
                case 's': player.moving.down = false; break;
                case 'a': player.moving.left = false; break;
                case 'd': player.moving.right = false; break;
            }
        });
        
        // Eventos do mouse
        canvas.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        
        canvas.addEventListener('mousedown', (e) => {
            if (e.button === 0) {
                shooting = true;
            }
        });
        
        canvas.addEventListener('mouseup', (e) => {
            if (e.button === 0) {
                shooting = false;
            }
        });
        
        // Redimensionar canvas quando a janela mudar de tamanho
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
        
        // Função para criar um novo inimigo
        function spawnEnemy() {
            let x, y;
            
            // Spawnar inimigos fora da tela
            if (Math.random() < 0.5) {
                x = Math.random() < 0.5 ? -enemySize : canvas.width + enemySize;
                y = Math.random() * canvas.height;
            } else {
                x = Math.random() * canvas.width;
                y = Math.random() < 0.5 ? -enemySize : canvas.height + enemySize;
            }
            
            enemies.push({
                x: x,
                y: y,
                size: enemySize,
                speed: enemySpeed,
                color: enemyColor,
                health: 20,
                coinValue: Math.floor(Math.random() * 3) + 1 // 1-3 moedas por inimigo
            });
        }
        
        // Função para obter cor baseada no naipe
        function getNaipeColor(naipe) {
            if (naipe === 'Copas' || naipe === 'Diamantes') {
                return '#e74c3c'; // Vermelho
            } else {
                return '#2c3e50'; // Preto
            }
        }
        
        // Função para obter características do boss baseadas na carta
        function getBossStats(valor, naipe) {
            // Modificadores baseados no valor da carta
            let healthMod = 1.0;
            let speedMod = 1.0;
            let sizeMod = 1.0;
            let attackRateMod = 1.0;
            let coinMod = 1.0;
            
            // Valores numéricos têm stats básicos
            if (['2', '3', '4', '5', '6', '7', '8', '9', '10'].includes(valor)) {
                const num = parseInt(valor);
                healthMod = 0.7 + (num / 2);
                speedMod = 0.8 + (num / 15);
                sizeMod = 0.8 + (num / 10);
                coinMod = 0.5 + (num / 10);
            }
            
            // Cartas de figura têm stats especiais
            if (valor === 'J') {
                speedMod = 6;
                healthMod = 6;
                sizeMod = 0.6;
                coinMod = 2;
            } else if (valor === 'Q') {
                sizeMod = 2;
                speedMod = 5;
                healthMod = 8;
                attackRateMod = 0.8; // Ataque mais rápido
                coinMod = 2.5;
            } else if (valor === 'K') {
                healthMod = 10;
                speedMod = 4.5;
                sizeMod = 2.5;
                coinMod = 3;
            } else if (valor === 'A') {
                healthMod = 20;
                speedMod = 4;
                sizeMod = 3;
                attackRateMod = 0.7; // Ataque mais rápido
                coinMod = 3.5;
            }
            
            // Modificadores baseados no naipe
            if (naipe === 'Paus') {
                healthMod *= 1.0;
            } else if (naipe === 'Copas') {
                healthMod *= 10;
                speedMod *= 1.2;
                coinMod *= 2.5;
            } else if (naipe === 'Diamantes') {
                healthMod *= 100;
                speedMod *= 1.2;
                attackRateMod *= 0.8; // Ataque mais rápido
                coinMod *= 5;
            } else if (naipe === 'Espadas') {
                healthMod *= 1000;
                speedMod *= 1.2;
                sizeMod *= 1.2;
                attackRateMod *= 0.8;
                coinMod *= 12;
            }
            
            return {
                health: Math.round(bossBaseHealth * healthMod),
                speed: bossBaseSpeed * speedMod,
                size: bossBaseSize * sizeMod,
                attackCooldown: 2000 * attackRateMod,
                color: getNaipeColor(naipe),
                coinValue: (Math.floor(Math.random() * 30) + 20) * coinMod // 20-50 moedas por boss
            };
        }
        
        // Função para criar um boss
        function spawnBoss() {
            const spawnSide = Math.floor(Math.random() * 4);
            let x, y;
            
            // Selecionar carta atual
            const currentValor = valores[currentValorIndex];
            const currentNaipe = naipes[currentNaipeIndex];
            const bossStats = getBossStats(currentValor, currentNaipe);
            
            // Avançar para a próxima carta
            currentValorIndex++;
            if (currentValorIndex >= valores.length) {
                currentValorIndex = 0;
                currentNaipeIndex++;
                if (currentNaipeIndex >= naipes.length) {
                    currentNaipeIndex = 0; // Voltar para o início se passar por todo o baralho
                }
            }
            
            switch(spawnSide) {
                case 0: // topo
                    x = canvas.width / 2;
                    y = -bossStats.size;
                    break;
                case 1: // direita
                    x = canvas.width + bossStats.size;
                    y = canvas.height / 2;
                    break;
                case 2: // baixo
                    x = canvas.width / 2;
                    y = canvas.height + bossStats.size;
                    break;
                case 3: // esquerda
                    x = -bossStats.size;
                    y = canvas.height / 2;
                    break;
            }
            
            boss = {
                x: x,
                y: y,
                size: bossStats.size,
                speed: bossStats.speed,
                color: bossStats.color,
                health: bossStats.health,
                maxHealth: bossStats.health,
                lastAttack: 0,
                attackCooldown: bossStats.attackCooldown,
                valor: currentValor,
                naipe: currentNaipe,
                coinValue: bossStats.coinValue
            };
            
            bossActive = true;
        }
        
        // Função para criar uma moeda
        function spawnCoin(x, y, value) {
            coinDrops.push({
                x: x,
                y: y,
                value: value,
                collected: false,
                opacity: 1.0,
                velocity: {
                    x: (Math.random() - 0.5) * 2,
                    y: -3 - Math.random() * 2
                }
            });
        }
        
        // Função para atualizar e desenhar moedas
        function updateCoins() {
            for (let i = coinDrops.length - 1; i >= 0; i--) {
                const coin = coinDrops[i];
                
                // Aplicar gravidade
                coin.velocity.y += 0.1;
                
                // Mover moeda
                coin.x += coin.velocity.x;
                coin.y += coin.velocity.y;
                
                // Simular quicar no chão
                if (coin.y > canvas.height - 10) {
                    coin.y = canvas.height - 10;
                    coin.velocity.y *= -0.6;
                    
                    // Reduzir velocidade horizontal
                    coin.velocity.x *= 0.8;
                }
                
                // Verificar colisão com o jogador (magnetismo quando próximo)
                const dx = player.x - coin.x;
                const dy = player.y - coin.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 100) { // Raio de magnetismo
                    // Mover em direção ao jogador
                    const angle = Math.atan2(dy, dx);
                    const pullSpeed = (100 - distance) / 20;
                    
                    coin.x += Math.cos(angle) * pullSpeed;
                    coin.y += Math.sin(angle) * pullSpeed;
                }
                
                // Coletar quando estiver muito próximo
                if (distance < player.size / 2 + 10) {
                    coins += coin.value;
                    coinsDisplayElement.textContent = `Moedas: ${coins}`;
                    coinDrops.splice(i, 1);
                    continue;
                }
                
                // Desenhar moeda
                ctx.beginPath();
                ctx.arc(coin.x, coin.y, 10, 0, Math.PI * 2);
                ctx.fillStyle = 'gold';
                ctx.fill();
                ctx.strokeStyle = '#FFA500';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.closePath();
                
                // Indicador de valor da moeda
                ctx.font = '8px Arial';
                ctx.fillStyle = '#000';
                ctx.textAlign = 'center';
                ctx.fillText(coin.value, coin.x, coin.y + 3);
            }
        }
        
        // Função para atirar
        function shoot() {
            if (Date.now() - lastShot > shootingCooldown) {
                const angleStep = 0.1; // Diferença de ângulo entre projéteis múltiplos
                
                for (let i = 0; i < bulletCount; i++) {
                    let angle;
                    
                    if (bulletCount === 1) {
                        angle = Math.atan2(mouseY - player.y, mouseX - player.x);
                    } else {
                        // Calcular ângulo com dispersão para tiros múltiplos
                        const spreadAngle = (bulletCount - 1) * angleStep;
                        angle = Math.atan2(mouseY - player.y, mouseX - player.x) - spreadAngle/2 + i * angleStep;
                    }
                    
                    bullets.push({
                        x: player.x,
                        y: player.y,
                        speed: bulletSpeed,
                        size: bulletSize,
                        color: bulletColor,
                        dx: Math.cos(angle) * bulletSpeed,
                        dy: Math.sin(angle) * bulletSpeed
                    });
                }
                
                lastShot = Date.now();
            }
        }
        
        // Loop principal do jogo
        function gameLoop() {
            if (gameOver) {
                drawGameOver();
                return;
            }
            
            // Limpar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Se o jogo estiver pausado, não atualizar
            if (gamePaused) {
                drawPlayer();
                drawEnemies();
                if (bossActive) {
                    drawBoss();
                }
                updateCoins();
                requestAnimationFrame(gameLoop);
                return;
            }
            
            // Atualizar timer do boss
            if (!bossActive) {
                const now = Date.now();
                if (now - lastBossTimerUpdate >= 1000) {
                    bossTimer--;
                    bossTimerElement.textContent = `Boss em: ${bossTimer}s`;
                    lastBossTimerUpdate = now;
                    
                    if (bossTimer <= 0) {
                        spawnBoss();
                        const nextValor = valores[currentValorIndex];
                        const nextNaipe = naipes[currentNaipeIndex];
                        bossTimerElement.textContent = `BOSS: ${boss.valor} de ${boss.naipe} | Próximo: ${nextValor} de ${nextNaipe}`;
                    }
                }
            }
            
            // Atirar se o mouse estiver pressionado
            if (shooting) {
                shoot();
            }
            
            // Mover o jogador
            movePlayer();
            
            // Atualizar e desenhar projéteis
            updateBullets();
            
            // Spawnar inimigos se não tiver boss
            if (!bossActive && Date.now() - lastEnemySpawn > enemySpawnRate) {
                spawnEnemy();
                lastEnemySpawn = Date.now();
            }
            
            // Atualizar e desenhar inimigos
            updateEnemies();
            
            // Atualizar e desenhar moedas
            updateCoins();
            
            // Atualizar e desenhar o boss
            if (bossActive) {
                updateBoss();
            }
            
            // Desenhar jogador
            drawPlayer();
            
            // Verificar colisões
            checkCollisions();
            
            // Atualizar estatísticas
            maxPlayerHealth = shopItems.health.baseValue + (shopItems.health.level - 1) * shopItems.health.increment;
            statsElement.textContent = `Pontos: ${score} | Vida: ${playerHealth}/${maxPlayerHealth}`;
            
            // Continuar o loop
            requestAnimationFrame(gameLoop);
        }
        
        // Mover o jogador baseado nas teclas pressionadas
        function movePlayer() {
            if (player.moving.up) player.y -= player.speed;
            if (player.moving.down) player.y += player.speed;
            if (player.moving.left) player.x -= player.speed;
            if (player.moving.right) player.x += player.speed;
            
            // Manter o jogador dentro do canvas
            player.x = Math.max(player.size / 2, Math.min(canvas.width - player.size / 2, player.x));
            player.y = Math.max(player.size / 2, Math.min(canvas.height - player.size / 2, player.y));
            
            // Atualizar direção do jogador (para onde está olhando)
            player.direction = Math.atan2(mouseY - player.y, mouseX - player.x);
        }
        
        // Atualizar e desenhar projéteis
        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                
                bullet.x += bullet.dx;
                bullet.y += bullet.dy;
                
                // Remover projéteis fora da tela
                if (
                    bullet.x < 0 ||
                    bullet.x > canvas.width ||
                    bullet.y < 0 ||
                    bullet.y > canvas.height
                ) {
                    bullets.splice(i, 1);
                    continue;
                }
                
                // Desenhar projétil
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.size, 0, Math.PI * 2);
                ctx.fillStyle = bullet.color;
                ctx.fill();
                ctx.closePath();
            }
        }
        
        // Atualizar e desenhar inimigos
        function updateEnemies() {
            drawEnemies();
            
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                
                // Se for um projétil do boss, verificar tempo de vida
                if (enemy.isBossProjectile) {
                    // Decrementar tempo de vida
                    enemy.lifeTime -= 16; // Aproximadamente 16ms por frame
                    
                    // Remover projétil se o tempo acabou
                    if (enemy.lifeTime <= 0) {waaaaaaa
                        enemies.splice(i, 1);
                        continue;
                    }
                }
                
                // Mover inimigo em direção ao jogador
                const dx = player.x - enemy.x;
                const dy = player.y - enemy.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 0) {
                    enemy.x += (dx / distance) * enemy.speed;
                    enemy.y += (dy / distance) * enemy.speed;
                }
            }
        }
        
        // Desenhar inimigos
        function drawEnemies() {
            for (let i = 0; i < enemies.length; i++) {
                const enemy = enemies[i];
                
                if (enemy.isBossProjectile) {
                    // Desenhar projétil do boss
                    ctx.beginPath();
                    ctx.arc(enemy.x, enemy.y, enemy.size, 0, Math.PI * 2);
                    ctx.fillStyle = '#e74c3c';
                    ctx.fill();
                    ctx.closePath();
                } else {
                    // Desenhar inimigo normal
                    ctx.beginPath();
                    ctx.arc(enemy.x, enemy.y, enemy.size, 0, Math.PI * 2);
                    ctx.fillStyle = enemy.color;
                    ctx.fill();
                    ctx.closePath();
                    
                    // Barra de vida do inimigo
                    const healthWidth = enemy.size * 1.5;
                    const currentHealth = (enemy.health / 20) * healthWidth;
                    
                    ctx.fillStyle = '#aaa';
                    ctx.fillRect(enemy.x - healthWidth / 2, enemy.y - enemy.size - 10, healthWidth, 5);
                    ctx.fillStyle = '#2ecc71';
                    ctx.fillRect(enemy.x - healthWidth / 2, enemy.y - enemy.size - 10, currentHealth, 5);
                }
            }
        }
        
        // Atualizar e desenhar o boss
        function updateBoss() {
            if (!boss) return;
            
            // Mover boss em direção ao jogador
            const dx = player.x - boss.x;
            const dy = player.y - boss.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance > 0) {
                boss.x += (dx / distance) * boss.speed;
                boss.y += (dy / distance) * boss.speed;
            }
            
            // Ataques do boss
            const now = Date.now();
            if (now - boss.lastAttack > boss.attackCooldown) {
                bossFire();
                boss.lastAttack = now;
            }
            
            // Desenhar boss
            drawBoss();
        }
        
        // Boss atira
        function bossFire() {
            // Padrões de tiro baseados no naipe do boss
            if (boss.naipe === 'Paus') {
                // Tiro circular
                for (let angle = 0; angle < Math.PI * 2; angle += Math.PI / 6) {
                    enemies.push({
                        x: boss.x,
                        y: boss.y,
                        size: 10,
                        speed: 4,
                        dx: Math.cos(angle) * 4,
                        dy: Math.sin(angle) * 4,
                        isBossProjectile: true,
                        lifeTime: 3000
                    });
                }
            } else if (boss.naipe === 'Copas') {
                // Tiro em forma de coração (mais projéteis na direção do jogador)
                const angleToPlayer = Math.atan2(player.y - boss.y, player.x - boss.x);
                
                // Tiro principal na direção do jogador
                enemies.push({
                    x: boss.x,
                    y: boss.y,
                    size: 15,
                    speed: 5,
                    dx: Math.cos(angleToPlayer) * 5,
                    dy: Math.sin(angleToPlayer) * 5,
                    isBossProjectile: true,
                    lifeTime: 4000
                });
                
                // Tiros menores em ângulos adjacentes
                for (let i = -2; i <= 2; i++) {
                    if (i === 0) continue; // Pular o central (já adicionado)
                    
                    const angle = angleToPlayer + (i * Math.PI / 8);
                    enemies.push({
                        x: boss.x,
                        y: boss.y,
                        size: 8,
                        speed: 4,
                        dx: Math.cos(angle) * 4,
                        dy: Math.sin(angle) * 4,
                        isBossProjectile: true,
                        lifeTime: 3000
                    });
                }
            } else if (boss.naipe === 'Diamantes') {
                // Tiro em forma de diamante (tiros rápidos em X)
                for (let i = 0; i < 4; i++) {
                    const angle = Math.PI / 4 + (i * Math.PI / 2);
                    enemies.push({
                        x: boss.x,
                        y: boss.y,
                        size: 12,
                        speed: 6,
                        dx: Math.cos(angle) * 6,
                        dy: Math.sin(angle) * 6,
                        isBossProjectile: true,
                        lifeTime: 2500
                    });
                }
            } else if (boss.naipe === 'Espadas') {
                // Tiro em linha com um grande projétil seguido de menores
                const angleToPlayer = Math.atan2(player.y - boss.y, player.x - boss.x);
                
                // Projétil grande principal
                enemies.push({
                    x: boss.x,
                    y: boss.y,
                    size: 18,
                    speed: 3,
                    dx: Math.cos(angleToPlayer) * 3,
                    dy: Math.sin(angleToPlayer) * 3,
                    isBossProjectile: true,
                    lifeTime: 5000
                });
                
                // Projéteis menores seguindo
                setTimeout(() => {
                    if (boss && !gameOver) {
                        for (let i = 0; i < 3; i++) {
                            enemies.push({
                                x: boss.x,
                                y: boss.y,
                                size: 10,
                                speed: 5,
                                dx: Math.cos(angleToPlayer) * 5,
                                dy: Math.sin(angleToPlayer) * 5,
                                isBossProjectile: true,
                                lifeTime: 4000
                            });
                        }
                    }
                }, 300);
            }
        }
        
        // Desenhar boss
        function drawBoss() {
            if (!boss) return;
            
            // Corpo do boss
            ctx.beginPath();
            ctx.arc(boss.x, boss.y, boss.size, 0, Math.PI * 2);
            ctx.fillStyle = boss.color;
            ctx.fill();
            ctx.closePath();
            
            // Desenhar símbolo do naipe no centro
            ctx.font = `${boss.size * 0.7}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            let naipeSymbol = '';
            if (boss.naipe === 'Copas') naipeSymbol = '♥';
            else if (boss.naipe === 'Espadas') naipeSymbol = '♠';
            else if (boss.naipe === 'Ouros' || boss.naipe === 'Diamantes') naipeSymbol = '♦';
            else if (boss.naipe === 'Paus') naipeSymbol = '♣';
            
            const symbolColor = boss.naipe === 'Copas' || boss.naipe === 'Diamantes' ? 'white' : 'white';
            ctx.fillStyle = symbolColor;
            ctx.fillText(naipeSymbol, boss.x, boss.y - boss.size * 0.1);
            
            // Valor da carta
            ctx.font = `${boss.size * 0.4}px Arial`;
            ctx.fillStyle = symbolColor;
            ctx.fillText(boss.valor, boss.x, boss.y + boss.size * 0.3);
            
            // Barra de vida do boss
            const healthWidth = boss.size * 3;
            const currentHealth = (boss.health / boss.maxHealth) * healthWidth;
            
            ctx.fillStyle = '#444';
            ctx.fillRect(boss.x - healthWidth / 2, boss.y - boss.size - 20, healthWidth, 10);
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(boss.x - healthWidth / 2, boss.y - boss.size - 20, currentHealth, 10);
            
            // Texto de vida
            ctx.font = '12px Arial';
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.fillText(`${boss.health}/${boss.maxHealth}`, boss.x, boss.y - boss.size - 25);
        }
        
        // Verificar colisões
        function checkCollisions() {
            // Colisão entre projéteis e inimigos
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                
                // Colisão com inimigos normais
                for (let j = enemies.length - 1; j >= 0; j--) {
                    const enemy = enemies[j];
                    
                    // Ignorar se for um projétil do boss
                    if (enemy.isBossProjectile) continue;
                    
                    const dx = bullet.x - enemy.x;
                    const dy = bullet.y - enemy.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < bullet.size + enemy.size) {
                        // Remover projétil
                        bullets.splice(i, 1);
                        
                        // Diminuir vida do inimigo
                        enemy.health -= 10;
                        
                        // Se o inimigo morreu
                        if (enemy.health <= 0) {
                            // Adicionar pontos
                            score += 10;
                            
                            // Soltar moedas
                            for (let k = 0; k < enemy.coinValue; k++) {
                                spawnCoin(enemy.x, enemy.y, 1);
                            }
                            
                            // Remover inimigo
                            enemies.splice(j, 1);
                        }
                        
                        // Sair do loop pois o projétil foi removido
                        break;
                    }
                }
                
                // Colisão com boss
                if (boss && bullet) {
                    const dx = bullet.x - boss.x;
                    const dy = bullet.y - boss.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < bullet.size + boss.size) {
                        // Remover projétil
                        bullets.splice(i, 1);
                        
                        // Diminuir vida do boss
                        boss.health -= 5;
                        
                        // Se o boss morreu
                        if (boss.health <= 0) {
                            // Adicionar pontos
                            score += 100;
                            
                            // Soltar moedas
                            for (let k = 0; k < boss.coinValue; k++) {
                                spawnCoin(boss.x, boss.y, 1);
                            }
                            
                            // Remover boss
                            boss = null;
                            bossActive = false;
                            
                            // Reiniciar timer para próximo boss
                            bossTimer = 15;
                            lastBossTimerUpdate = Date.now();
                            bossTimerElement.textContent = `Boss em: ${bossTimer}s`;
                        }
                    }
                }
            }
            
            // Colisão entre jogador e inimigos
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                const dx = player.x - enemy.x;
                const dy = player.y - enemy.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                const collisionRadius = player.size / 2 + (enemy.isBossProjectile ? enemy.size : enemy.size);
                
                if (distance < collisionRadius) {
                    // Dano ao jogador
                    playerHealth -= enemy.isBossProjectile ? 10 : 5;
                    
                    // Remover inimigo/projétil
                    enemies.splice(i, 1);
                    
                    // Verificar game over
                    if (playerHealth <= 0) {
                        gameOver = true;
                    }
                }
            }
            
            // Colisão entre jogador e boss
            if (boss) {
                const dx = player.x - boss.x;
                const dy = player.y - boss.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < player.size / 2 + boss.size) {
                    // Dano ao jogador
                    playerHealth -= 15;
                    
                    // Empurrar jogador para longe do boss
                    const pushAngle = Math.atan2(dy, dx);
                    player.x += Math.cos(pushAngle) * 30;
                    player.y += Math.sin(pushAngle) * 30;
                    
                    // Verificar game over
                    if (playerHealth <= 0) {
                        gameOver = true;
                    }
                }
            }
        }
        
        // Desenhar o jogador
        function drawPlayer() {
            // Desenhar corpo do jogador
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.size / 2, 0, Math.PI * 2);
            ctx.fillStyle = player.color;
            ctx.fill();
            ctx.closePath();
            
            // Desenhar direção (cano da arma)
            const gunLength = player.size / 2 + 15;
            const endX = player.x + Math.cos(player.direction) * gunLength;
            const endY = player.y + Math.sin(player.direction) * gunLength;
            
            ctx.beginPath();
            ctx.moveTo(player.x, player.y);
            ctx.lineTo(endX, endY);
            ctx.lineWidth = 8;
            ctx.strokeStyle = '#555';
            ctx.stroke();
            ctx.closePath();
            
            // Barra de vida do jogador (opcional, já que temos a UI)
            const healthWidth = player.size * 2;
            const currentHealth = (playerHealth / maxPlayerHealth) * healthWidth;
            
            ctx.fillStyle = '#555';
            ctx.fillRect(player.x - healthWidth / 2, player.y - player.size - 15, healthWidth, 5);
            ctx.fillStyle = '#27ae60';
            ctx.fillRect(player.x - healthWidth / 2, player.y - player.size - 15, currentHealth, 5);
        }
        
        // Tela de game over
        function drawGameOver() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.font = 'bold 48px Arial';
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 50);
            
            ctx.font = '24px Arial';
            ctx.fillText(`Pontuação: ${score}`, canvas.width / 2, canvas.height / 2);
            ctx.fillText(`Moedas coletadas: ${coins}`, canvas.width / 2, canvas.height / 2 + 40);
            
            ctx.font = '18px Arial';
            ctx.fillText('Clique para jogar novamente', canvas.width / 2, canvas.height / 2 + 100);
            
            // Evento de clique para reiniciar
            canvas.addEventListener('click', resetGame);
        }
        
        // Reiniciar o jogo
        function resetGame() {
            // Remover o evento de clique para evitar múltiplos registros
            canvas.removeEventListener('click', resetGame);
            
            // Reiniciar variáveis principais
            score = 0;
            playerHealth = 100;
            gameOver = false;
            bossTimer = 15;
            lastBossTimerUpdate = Date.now();
            bossActive = false;
            boss = null;
            coins = 0;
            
            // Limpar arrays
            bullets.length = 0;
            enemies.length = 0;
            coinDrops.length = 0;
            
            // Resetar status na UI
            statsElement.textContent = `Pontos: 0 | Vida: 100/${maxPlayerHealth}`;
            bossTimerElement.textContent = `Boss em: 15s`;
            coinsDisplayElement.textContent = `Moedas: 0`;
            
            // Resetar melhorias ao nível inicial (opcional, pode manter as compras)
            // Para resetar completamente, descomentar o código abaixo:
            /*
            for (const key in shopItems) {
                shopItems[key].level = 1;
            }
            bulletCount = 1;
            shootingCooldown = 150;
            player.speed = 5;
            bulletSize = 5;
            */
            
            // Reiniciar a posição do jogador
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
            
            // Continuar o jogo
            gameLoop();
        }
        
        // Iniciar o jogo
        gameLoop();
    </script>
</body>
</html>